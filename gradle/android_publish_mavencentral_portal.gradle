if (versions == null || versions.publish_version == null) {
    throw new IllegalStateException("Unable to reference publish_version!")
} else if (module_group == null || module_name == null) {
    throw new IllegalStateException("Must provide module_group and module_name!")
}

group = module_group
version = versions.publish_version

apply plugin: 'tech.medivh.plugin.publisher'
apply plugin: 'signing'

signing {
    useGpgCmd() //ä½¿ç”¨ gpg-agent
}

medivhPublisher {
    groupId module_group
    artifactId module_name
    version versions.publish_version

    pom {
        packaging 'aar'
        name = module_name
        description = 'ğŸ˜ A beautiful, fluid, and extensible dialogs API for Kotlin & Android.'
        url = 'https://github.com/Heart-Beats/material-dialogs'
        licenses {
            license {
                name = 'Apache 2.0 License'
                url = 'https://github.com/Heart-Beats/material-dialogs/blob/main/LICENSE.md'
            }
        }
        developers {
            developer {
                id = 'afollestad'
                name = 'Aidan Follestad'
                email = 'dont-email-me@af.codes'
            }
        }
        // Version control info - if you're using GitHub, follow the format as seen here
        scm {
            connection = 'scm:git:github.com/Heart-Beats/material-dialogs.git'
            developerConnection = 'scm:git:ssh://github.com/Heart-Beats/material-dialogs.git'
            url = 'https://github.com/Heart-Beats/material-dialogs/tree/main'
        }

        //    ä¸€ä¸ªç¨å¾®æœ‰ç‚¹ hacky çš„ä¿®å¤ï¼Œä»¥ä¾¿æ‚¨çš„ POM å°†åŒ…å«æ‚¨çš„åº“æ‰€æ„å»ºçš„ä»»ä½•ä¼ é€’ä¾èµ–é¡¹
        withXml {
            def dependenciesNode = asNode().appendNode('dependencies')

            // è¯¥ä¾èµ–åŒ…æ‹¬ implementation å’Œ api ä¾èµ–
            def implementationDependencies = project.configurations.implementation.allDependencies
            def apiDependencies = project.configurations.api.allDependencies
            def compileOnlyDependencies = project.configurations.compileOnly.allDependencies

            def realImplementationDependencies = implementationDependencies - apiDependencies

            // ç”Ÿæˆ implementation èŠ‚ç‚¹ä¾èµ–
            realImplementationDependencies.each {
                createDependencyNode(dependenciesNode, 'runtime', it.group, it.name, it.version)
            }

            // ç”Ÿæˆ api èŠ‚ç‚¹ä¾èµ–
            apiDependencies.each {
                createDependencyNode(dependenciesNode, 'compile', it.group, it.name, it.version)
            }

            // ç”Ÿæˆ compileOnly èŠ‚ç‚¹ä¾èµ–
            compileOnlyDependencies.each {
                createDependencyNode(dependenciesNode, 'provided', it.group, it.name, it.version)
            }
        }
    }
}


/**
 *
 * è®¾ç½® pom æ–‡ä»¶çš„ dependenciesèŠ‚ç‚¹
 *      åˆ«çš„é¡¹ç›®ä¾èµ–è¯¥ pom  æ–‡ä»¶æ—¶ï¼Œä¼šä» dependenciesèŠ‚ç‚¹ä¸‹æ ¹æ® scope æ¥é€‰æ‹©æ˜¯å¦ä¸‹è½½ä¾èµ–åº“
 *
 *  scope æœ‰å¦‚ä¸‹å–å€¼ï¼š
 *      compileï¼š      å¦‚æœæ²¡æœ‰æŒ‡å®š scope æ ‡ç­¾ï¼Œmaven é»˜è®¤ä¸ºè¿™ä¸ªèŒƒå›´ã€‚ç¼–è¯‘ä¾èµ–å…³ç³»åœ¨æ‰€æœ‰ classpath ä¸­éƒ½å¯ç”¨ã€‚æ­¤å¤–ï¼Œè¿™äº›ä¾èµ–å…³ç³»è¢«ä¼ æ’­åˆ°ä¾èµ–é¡¹ç›®
 *      providedï¼š    ä¸ compile ç±»ä¼¼ï¼Œä½†æ˜¯è¡¨ç¤ºæ‚¨å¸Œæœ› jdk æˆ–å®¹å™¨åœ¨è¿è¡Œæ—¶æä¾›å®ƒ(å³ç³»ç»Ÿç±»åº“)ã€‚å®ƒåªé€‚ç”¨äºç¼–è¯‘å’Œæµ‹è¯• classpathï¼Œä¸å¯ä¼ é€’
 *      runtimeï¼š    æ­¤èŒƒå›´è¡¨ç¤ºç¼–è¯‘ä¸éœ€è¦ä¾èµ–å…³ç³»ï¼Œè€Œæ˜¯ç”¨äºæ‰§è¡Œã€‚å®ƒæ˜¯åœ¨è¿è¡Œæ—¶å’Œæµ‹è¯• classpathï¼Œä½†ä¸æ˜¯ç¼–è¯‘ classpath
 *      testï¼š      æ­¤èŒƒå›´è¡¨ç¤ºæ­£å¸¸ä½¿ç”¨åº”ç”¨ç¨‹åºä¸éœ€è¦ä¾èµ–å…³ç³»ï¼Œä»…é€‚ç”¨äºæµ‹è¯•ç¼–è¯‘å’Œæ‰§è¡Œé˜¶æ®µã€‚å®ƒä¸æ˜¯ä¼ é€’çš„ã€‚
 *      systemï¼š   æ­¤èŒƒå›´ä¸ provided ç±»ä¼¼ï¼Œé™¤äº†æ‚¨å¿…é¡»æä¾›æ˜ç¡®åŒ…å«å®ƒçš„ jarã€‚è¯¥ artifact å§‹ç»ˆå¯ç”¨ï¼Œå¹¶ä¸”ä¸æ˜¯åœ¨ä»“åº“ä¸­æŸ¥æ‰¾ã€‚
 *
 *      å¸¸ç”¨ç±»æ¯”æ€»ç»“ï¼š
 *
 *       maven ä¸­     |    gradle ä¸­
 *       ---------------------------
 *        compile    |       api
 *       provided    |   compileOnly
 *       runtime     | implementation
 *
 */
private static def createDependencyNode(root, scope, groupId, artifactId, version) {
    def dependencyNode = root.appendNode('dependency')
    dependencyNode.appendNode('groupId', groupId)
    dependencyNode.appendNode('artifactId', artifactId)
    dependencyNode.appendNode('version', version)
    dependencyNode.appendNode('scope', scope)
}